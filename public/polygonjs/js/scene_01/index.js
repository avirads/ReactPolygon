import{d as U,e as A}from"./chunk-UGBFX4GW.js";function T(e){return e.replace(/([^:])\/\//g,"$1/")}var w=(e=>(e.EXPORT_MANIFEST="scene/export_manifest.json",e.CODE_PREFIX="scene/code",e.PROPERTIES="scene/code/properties.json",e.EDITOR="scene/editor.json",e.ASSETS="scene/assets.json",e.POLYGONJS="js/all.js",e.SCENE_DATA_LOADER="js/sceneDataLoader.js",e.POLY_CONFIG="js/polyConfig.js",e.JS_FILES="scene/js_files.json",e.POSTER="images/poster.png",e))(w||{});function G(e){let{urlPrefix:s,nodePath:o,shaderName:n,timestamp:r}=e;return`${s}/root/${o}.${n}.glsl?t=${r}`}function b(e,s){let o=Object.keys(e.shaders);for(let n of o){let r=e.shaders[n],c=Object.keys(r);for(let l of c){let u=r[l];s({nodePath:n,shaderName:l,timestamp:u})}}}var y=class{static async importSceneData(s){s.editorMode==null&&(s.editorMode=!1);let o=s.manifest,n=s.urlPrefix||w.CODE_PREFIX,r=Object.keys(o.nodes),c=[];for(let t of r){let i=o.nodes[t],d=`${n}/root/${t}.json?t=${i}`;c.push(d)}let l=`${n}/root.json?t=${o.root}`,u=`${n}/properties.json?t=${o.properties}`,p=[l,u];if(s.editorMode){let t=Date.now();p.push(`${n}/ui.json?t=${t}`)}for(let t of c)p.push(t);let _=[];b(o,t=>{let i=G({urlPrefix:n,...t});p.push(i),_.push(i)});let g=0,h=p.length-_.length,m=p.length;function j(){g++;let t=g/m,i=A.sceneData,d=i.start+i.mult*t;s.onProgress&&s.onProgress(d),U.dispatchProgressEvent(d,s.sceneName)}let S=p.map(t=>T(t)).map(t=>fetch(t)),R=await Promise.all(S),P=R.slice(0,h),O=R.slice(h),x=await Promise.all([...P.map(t=>(j(),t.json())),...O.map(t=>(j(),t.text()))]),f=x.slice(0,h),D=x.slice(h),M=0,a={};b(o,t=>{let i=D[M],{nodePath:d,shaderName:z}=t;a[d]=a[d]||{},a[d][z]=i,M++});let E={root:f[0],properties:f[1],shaders:a},I=2;s.editorMode&&(E.ui=f[2],I+=1);let N={},$=Object.keys(o.nodes);for(let t=0;t<$.length;t++){let i=$[t],d=f[t+I];N[i]=d}return this.assemble(E,$,N)}static async assemble(s,o,n){let r={root:s.root,properties:s.properties,ui:s.ui,shaders:s.shaders};for(let c=0;c<o.length;c++){let l=o[c],u=n[l];this._insertChildData(r.root,l,u)}return r}static _insertChildData(s,o,n){let r=o.split("/");if(r.length==1)s.nodes||(s.nodes={}),s.nodes[o]=n;else{let c=r.shift(),l=r.join("/"),u=s.nodes[c];this._insertChildData(u,l,n)}}};var V={properties:"1671644119281",root:"1671644119281",nodes:{perspectiveCamera1:"1671644119281","perspectiveCamera1/events1":"1671644119281",grid:"1671644119281"},shaders:{}},v=async(e={})=>{let s=e.sceneDataRoot||"./polygonjs/scenes";return await y.importSceneData({sceneName:"scene_01",urlPrefix:s+"/scene_01",manifest:V,onProgress:e.onProgress})};var k=async function(e={}){let{onProgress:s,domElement:o,configureSceneData:n,autoPlay:r,createViewer:c,sceneDataRoot:l,assetsRoot:u,libsRootPrefix:p,printWarnings:_,renderer:g,cameraMaskOverride:h}=e,m=e.sceneData,j=e.runRegister!=null?e.runRegister:!0,S=(e.loadModules!=null?e.loadModules:!0)?[]:[],R=[import("./loadSceneFromSceneData-KRSC5STV.js"),m==null?v({onProgress:s,sceneDataRoot:l}):(()=>new Promise(a=>a()))()],P=await Promise.all(R),{Poly:O,loadSceneFromSceneData_scene_01:x}=P[0];m==null&&(m=P[1]),n&&n(m);let f=[];for(let a=2;a<P.length;a++)f.push(P[a]);let D=0;for(let a of S){let E=a+"Module";O.registerModule(f[D][E]),D++}return await x({onProgress:s,sceneData:m,domElement:o,runRegister:j,autoPlay:r,createViewer:c,assetsRoot:u,libsRootPrefix:p,printWarnings:_,renderer:g,cameraMaskOverride:h})};var C=async function(e={}){return e&&e.createViewer==null&&(e.createViewer=!0),k(e)};async function oe(e){let{publicPath:s,onProgress:o}=e,n=e.domElement||"polygonjs-app-scene_01";return await C({domElement:n,autoPlay:!0,onProgress:o,moduleImportSuffix:".js",sceneDataRoot:s+"/polygonjs/scenes",assetsRoot:s,libsRootPrefix:s})}export{oe as loadSceneAndMount_scene_01};
